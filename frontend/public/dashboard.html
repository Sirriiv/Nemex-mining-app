<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEMEXCOIN</title>
<style>
/* Your existing CSS styles remain the same */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Arial',sans-serif}
body{background:#0f0f1a;color:#fff;max-width:400px;margin:0 auto;padding-bottom:80px;overflow-x:hidden}
.loading{position:fixed;top:0;left:0;width:100%;height:100%;background:#0f0f1a;color:#d4af37;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;transition:opacity 0.3s}
.loading-logo{font-size:72px;margin-bottom:20px;font-weight:700;animation:pulse 2s infinite}
.loading-status{font-size:16px;letter-spacing:0.5px}
.hidden{opacity:0;pointer-events:none}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #1a1a2a;background:#0f0f1a}
.logo{font-weight:700;color:#d4af37;font-size:18px;letter-spacing:1px}
.dashboard{text-align:center;padding:40px 20px;animation:fadeIn 0.5s}
.balance{font-size:52px;font-weight:700;margin:20px 0;color:#d4af37;text-shadow:0 0 20px rgba(212,175,55,0.3)}
.chip-icon{font-size:32px;margin:20px 0;opacity:0.8}
.timer{font-size:14px;color:#aaa;margin:10px 0;letter-spacing:1px}
.claim-btn{background:linear-gradient(135deg,#d4af37,#b8941f);color:#0f0f1a;border:none;padding:14px 40px;border-radius:25px;font-size:16px;font-weight:600;margin:20px 0;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(212,175,55,0.3)}
.claim-btn:active{transform:scale(0.95)}
.claim-btn:disabled{background:#333;color:#666;cursor:not-allowed;box-shadow:none}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#1a1a2a;display:flex;justify-content:space-around;padding:12px 0;max-width:400px;margin:0 auto;border-top:1px solid #2a2a3a;backdrop-filter:blur(10px)}
.nav-item{display:flex;flex-direction:column;align-items:center;padding:8px 12px;color:#666;cursor:pointer;transition:all 0.3s;border-radius:12px;min-width:60px}
.nav-item.active{color:#d4af37;transform:translateY(-2px)}
.nav-icon{font-size:22px;margin-bottom:4px;transition:all 0.3s}
.nav-item.active .nav-icon{transform:scale(1.1)}
.nav-label{font-size:11px;font-weight:500;letter-spacing:0.5px}
.section{display:none;padding:30px 20px;text-align:center;animation:fadeIn 0.5s}
.section.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.section h2{color:#d4af37;margin-bottom:15px;font-size:24px}
.section p{color:#aaa;line-height:1.5}
</style>
</head>
<body>
<div id="loading" class="loading hidden">
    <div class="loading-logo">NMX</div>
    <div class="loading-status">Initializing‚Ä¶</div>
</div>

<div class="header">
    <div class="logo">NEMEXCOIN</div>
    <div style="font-size:20px">‚öôÔ∏è</div>
</div>

<div id="home" class="section active">
    <div class="dashboard">
        <div class="balance" id="balanceDisplay">00</div>
        <div class="chip-icon">üíø</div>
        <div class="timer" id="timerDisplay">Claim in 24:00:00</div>
        <button class="claim-btn" id="claimButton" disabled>30 NMXp</button>
    </div>
</div>

<div id="tasks" class="section">
    <h2>üìã Tasks</h2>
    <p>Complete daily tasks and challenges to earn bonus NMX rewards</p>
</div>

<div id="buy" class="section">
    <h2>üõí Buy NMXp</h2>
    <p>Purchase NMX(points) tokens securely with multiple payment options</p>
</div>

<div id="referrals" class="section">
    <h2>üë• Referrals</h2>
    <p>Invite friends and earn mining rewards</p>
</div>

<div id="wallet" class="section">
    <h2>üí∞ Wallet</h2>
    <p>Manage your assets and NMXp balance and transaction history</p>
</div>

<div class="bottom-nav">
    <div class="nav-item active" data-section="home">
        <div class="nav-icon">üè†</div>
        <div class="nav-label">Home</div>
    </div>
    <div class="nav-item" data-section="tasks">
        <div class="nav-icon">üìã</div>
        <div class="nav-label">Tasks</div>
    </div>
    <div class="nav-item" data-section="buy">
        <div class="nav-icon">üõí</div>
        <div class="nav-label">Buy</div>
    </div>
    <div class="nav-item" data-section="referrals">
        <div class="nav-icon">üë•</div>
        <div class="nav-label">Referrals</div>
    </div>
    <div class="nav-item" data-section="wallet">
        <div class="nav-icon">üí∞</div>
        <div class="nav-label">Wallet</div>
    </div>
</div>

<script>
// Tab Switching Code
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', function() {
        const target = this.getAttribute('data-section');
        const loading = document.getElementById('loading');
        
        loading.classList.remove('hidden');
        
        setTimeout(() => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(target).classList.add('active');
            this.classList.add('active');
            
            setTimeout(() => loading.classList.add('hidden'), 300);
        }, 1500);
    });
});

// SUPABASE-BACKED COUNTDOWN TIMER
const API_BASE = 'https://nemex-backend.onrender.com'; // UPDATED WITH YOUR ACTUAL URL
let countdownInterval;
let currentUserId = localStorage.getItem('userId') || generateUserId();

// Get elements
const timerDisplay = document.getElementById('timerDisplay');
const balanceDisplay = document.getElementById('balanceDisplay');
const claimButton = document.getElementById('claimButton');

// Generate unique user ID
function generateUserId() {
    const userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    localStorage.setItem('userId', userId);
    return userId;
}

// Format time as HH:MM:SS
function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// Load user data from backend
async function loadUserData() {
    try {
        showLoading('Loading your data...');
        
        const response = await fetch(`${API_BASE}/api/user/${currentUserId}`);
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || 'Failed to load user data');
        }
        
        balanceDisplay.textContent = data.balance;
        
        if (data.remainingTime > 0) {
            startCountdown(data.remainingTime);
            claimButton.disabled = true;
            claimButton.textContent = '30 NMXp';
        } else {
            timerDisplay.textContent = 'Ready to Claim!';
            claimButton.disabled = false;
            claimButton.textContent = 'CLAIM 30 NMXp';
        }
        
        hideLoading();
    } catch (error) {
        console.error('Error loading user data:', error);
        hideLoading();
        // Fallback to localStorage if backend fails
        fallbackToLocalStorage();
    }
}

// Show loading state
function showLoading(message = 'Loading...') {
    const loading = document.getElementById('loading');
    const status = loading.querySelector('.loading-status');
    status.textContent = message;
    loading.classList.remove('hidden');
}

// Hide loading state
function hideLoading() {
    setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
    }, 500);
}

// Start countdown timer
function startCountdown(initialTime) {
    let remainingTime = initialTime;
    
    clearInterval(countdownInterval);
    
    function update() {
        if (remainingTime > 0) {
            timerDisplay.textContent = `Claim in ${formatTime(remainingTime)}`;
            remainingTime--;
            
            // Auto-save progress every minute
            if (remainingTime % 60 === 0) {
                localStorage.setItem('backupCountdown', remainingTime);
                localStorage.setItem('backupLastUpdate', Date.now());
            }
        } else {
            timerDisplay.textContent = 'Ready to Claim!';
            claimButton.disabled = false;
            claimButton.textContent = 'CLAIM 30 NMXp';
            clearInterval(countdownInterval);
        }
    }
    
    update(); // Initial update
    countdownInterval = setInterval(update, 1000);
}

// Claim reward
async function claimReward() {
    try {
        claimButton.disabled = true;
        claimButton.textContent = 'Claiming...';
        
        const response = await fetch(`${API_BASE}/api/claim/${currentUserId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });
        
        const data = await response.json();
        
        if (response.ok) {
            balanceDisplay.textContent = data.balance;
            startCountdown(24 * 60 * 60); // Reset to 24 hours
            claimButton.textContent = '30 NMXp';
            
            // Show success message
            alert('‚úÖ ' + data.message);
        } else {
            alert('‚ùå Error: ' + data.error);
            claimButton.disabled = false;
            claimButton.textContent = 'CLAIM 30 NMXp';
        }
    } catch (error) {
        console.error('Error claiming reward:', error);
        alert('‚ùå Network error. Please try again.');
        claimButton.disabled = false;
        claimButton.textContent = 'CLAIM 30 NMXp';
    }
}

// Fallback to localStorage if backend fails
function fallbackToLocalStorage() {
    const savedBalance = localStorage.getItem('nmxBalance');
    const savedCountdown = localStorage.getItem('backupCountdown');
    const savedLastUpdate = localStorage.getItem('backupLastUpdate');
    
    if (savedBalance) {
        balanceDisplay.textContent = savedBalance;
    }
    
    if (savedCountdown && savedLastUpdate) {
        const elapsedSeconds = Math.floor((Date.now() - parseInt(savedLastUpdate)) / 1000);
        const remainingTime = Math.max(0, parseInt(savedCountdown) - elapsedSeconds);
        startCountdown(remainingTime);
    } else {
        startCountdown(24 * 60 * 60);
    }
    
    alert('‚ö†Ô∏è Using offline mode. Some features may be limited.');
}

// Initialize
loadUserData();
claimButton.addEventListener('click', claimReward);
</script>
</body>
</html>