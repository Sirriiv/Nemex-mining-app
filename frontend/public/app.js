// Telegram Web App Integration
document.addEventListener('DOMContentLoaded', function() {
    initTelegramApp();
        setupBasicHandlers();
        });

        function initTelegramApp() {
            const tg = window.Telegram?.WebApp;
                if (!tg) return;
                    
                        tg.expand();
                            
                                if (tg.initDataUnsafe?.user) {
                                        const user = tg.initDataUnsafe.user;
                                                document.getElementById('telegram-welcome').style.display = 'block';
                                                        
                                                                // Auto-fill forms
                                                                        const inputs = document.querySelectorAll('input[type="text"]');
                                                                                inputs.forEach(input => {
                                                                                            if (input.placeholder?.includes('wallet') || input.placeholder?.includes('username')) {
                                                                                                            input.value = user.username || `tg_${user.id}`;
                                                                                                                        }
                                                                                                                                });
                                                                                                                                    }
                                                                                                                                    }

                                                                                                                                    function setupBasicHandlers() {
                                                                                                                                        // Login form
                                                                                                                                            const loginForm = document.getElementById('login-form');
                                                                                                                                                if (loginForm) {
                                                                                                                                                        loginForm.addEventListener('submit', function(e) {
                                                                                                                                                                    e.preventDefault();
                                                                                                                                                                                alert('Login functionality coming soon!');
                                                                                                                                                                                        });
                                                                                                                                                                                            }
                                                                                                                                                                                                
                                                                                                                                                                                                    // Register form
                                                                                                                                                                                                        const registerForm = document.getElementById('register-form');
                                                                                                                                                                                                            if (registerForm) {
                                                                                                                                                                                                                    registerForm.addEventListener('submit', function(e) {
                                                                                                                                                                                                                                e.preventDefault();
                                                                                                                                                                                                                                            alert('Registration functionality coming soon!');
                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                // Mining button
                                                                                                                                                                                                                                                                    const mineBtn = document.getElementById('mine-button');
                                                                                                                                                                                                                                                                        if (mineBtn) {
                                                                                                                                                                                                                                                                                mineBtn.addEventListener('click', function() {
                                                                                                                                                                                                                                                                                            mineBtn.textContent = '⛏️ Mining...';
                                                                                                                                                                                                                                                                                                        mineBtn.disabled = true;
                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                                                mineBtn.textContent = '⛏️ Start Mining';
                                                                                                                                                                                                                                                                                                                                                                mineBtn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                alert('Mined 0.5 NMX!');
                                                                                                                                                                                                                                                                                                                                                                                            }, 2000);
                                                                                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                // Referral button
                                                                                                                                                                                                                                                                                                                                                                                                                    const refBtn = document.getElementById('generate-referral');
                                                                                                                                                                                                                                                                                                                                                                                                                        if (refBtn) {
                                                                                                                                                                                                                                                                                                                                                                                                                                refBtn.addEventListener('click', function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                            const code = Math.random().toString(36).substring(2, 6).toUpperCase();
                                                                                                                                                                                                                                                                                                                                                                                                                                                        const link = `https://nmx-mining-app.onrender.com?ref=${code}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alert(`Referral link: ${link}`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Simple Telegram auth
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function handleTelegramAuth() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const tg = window.Telegram?.WebApp;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (tg?.initDataUnsafe?.user) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alert('Already signed in with Telegram!');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alert('Open this in Telegram bot to use Telegram features!');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Make functions global
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                window.handleTelegramAuth = handleTelegramAuth;